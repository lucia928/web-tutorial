# 双向数据绑定

对于传统的`dom操作`，当数据变化时更新视图需要先获取到目标节点，然后将改变的值放入节点中；视图发生变化时，需要绑定事件修改数据。双向数据绑定恰好能解决这种繁琐的操作，数据变化后自动更新视图，视图变化后更新数据，能让开发者更加专注于处理业务逻辑。

## 实现原理

- 通过`数据劫持` + `发布-订阅模式` 来实现。
- 通过`Object.defineProperty `/ `Proxy`重写`getter`和`setter`方法。在`getter`函数触发时收集依赖，将订阅者保存到订阅中心；在`setter`函数触发时通知订阅者更新视图。
- 编译器需要对模板进行编译，在编译过程中，分析模板中哪些节点使用到了指令，给这个节点绑定更新函数，创建一个订阅者并绑定更新函数，初始化订阅者，这时触发一下`getter`会被劫持，将订阅者保存到订阅中心。
- 分析模板时，会遍历节点，分析节点类型`nodeType`，`nodeType`为2时正则匹配双花括号，初始化值创建订阅者；`nodeType`为1时，遍历属性`attributes`
  - 如果是`v-model`则根据元素的类型绑定事件，`input`、`textarea`就绑定`input`事件，将`value`赋值给绑定的数据。如果是`checkbox`、`radio`、`select`就绑定`change`事件，将`checked`、`selsect`属性的值赋值给绑定的数据。
  - 遇到`v-on`指令就分割指令获取到事件名，绑定事件跟回调函数。

![data_binding](./images/data_binding.png)